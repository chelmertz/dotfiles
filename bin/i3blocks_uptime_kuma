#!/usr/bin/env bash

if [[ "$BLOCK_BUTTON" != "" ]]; then
	url=http://localhost:3001/dashboard
	xdg-open "$url" &>/dev/null && i3-msg workspace number 2 &>/dev/null && wmctrl -a firefox &>/dev/null
else
	out=$(curl --silent localhost:3001/metrics)
	if [[ $? -ne 0 ]]; then
		echo "Failed to query uptime kuma at localhost:3001"
		exit 1
	fi

	down_count=$(echo "$out" | grep monitor_status | grep -v '^#' | grep ' 0$' | wc -l)
	if [[ "$down_count" != "0" ]]; then
		echo "uptime kuma errors: $down_count"
		exit 33
	fi
fi

