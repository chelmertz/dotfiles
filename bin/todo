#!/usr/bin/env bash

# using gojo to handle newlines properly: https://github.com/itchyny/gojo
todo=$(gojo name="$*")

test -z "$FAVRO_ORG_ID" && echo missing FAVRO_ORG_ID which can be found in the URL, check your browser && exit 1
test -z "$FAVRO_EMAIL" && echo missing FAVRO_EMAIL && exit 1
test -z "$FAVRO_API_TOKEN" && echo missing FAVRO_API_TOKEN, generate it from your profile page && exit 1

curl -X POST "https://favro.com/api/v1/cards" \
    -d "$todo" -H "organizationId: $FAVRO_ORG_ID" \
    -H "Content-Type: application/json" \
    -u "$FAVRO_EMAIL":"$FAVRO_API_TOKEN"
